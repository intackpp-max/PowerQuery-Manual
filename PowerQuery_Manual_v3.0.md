# Power Query 실무 매뉴얼 v3.0
## 원주농협 조합원관리 데이터 가공 가이드

---

## 📋 이 매뉴얼은

- **대상**: 행정양식 → 농협 템플릿으로 데이터를 변환해야 하는 직원
- **목표**: 버튼 몇 개만 클릭해도 정확한 결과물이 나오도록
- **핵심**: 매칭키(이름+생년월일+핸드폰)로 조합원/비조합원 자동 구분

---

## 🔄 연간 프로세스 개요

```
11월~1월: 농업인 신청 (행정 데이터)   ↓
1월~2월: 데이터 농협에 통보 (데이터 수마)   ↓
2월: Power Query로 데이터 정리 (이 매뉴얼이 여기!)   ↓
2월~3월: 공급 시작 (조합원 데이터 기반)   ↓
3월~4월: 대금 수납 (결제 가능)```

---

## 💡 Power Query 3가지 핵심 개념

### 1) 로드(Load)
**"여러 엑셀 파일을 한 곳으로 모은다"**
- 행정양식(농협제출용) + 조합원정보 엑셀을 연결

### 2) 변환(Transform)
**"데이터를 농협 양식으로 정리한다"**
- 이름+생년월일+핸드폰으로 조합원 찾기
- 텍스트 정리, 날짜 변환, 중복 제거

### 3) 로드(결과)
**"정리된 데이터를 새 시트에 깔끔하게 저장한다"**
- 엑셀 테이블로 변환하면 원본 데이터는 안전하게 보호됨

---

## ✅ 준비 물품 체크리스트

☐ 행정 신청 데이터 엑셀 (예: "2024_신청자명단.xlsx")
☐ 농협 조합원정보 엑셀 (예: "조합원정보_2024.xlsx")  
☐ 빈 엑셀 파일 1개 (Power Query 작업용)

---

## 🎯 Step 1: Power Query 시작하기

### GUI로 따라하기

**1단계: 엑셀 열기**
- 빈 엑셀 파일을 실행합니다

**2단계: Power Query 찾기**
```
Excel 상단 메뉴
  → "데이터" 탭 클릭
  → 왼쪽 끝에 "데이터 가져오기" 또는 "새 쿼리" 보임
```

**3단계: 첫 번째 데이터 로드**
```
"데이터 가져오기" → "파일에서" → "Excel 통합 문서"
  → "2024_신청자명단.xlsx" 파일 선택
  → "로드" 버튼 클릭
```

✅ **결과**: 엑셀에 새 시트 "2024_신청자명단" 이 자동 생성됩니다

---

## 🎯 Step 2: 조합원정보 매칭하기 (병합)

이 단계가 가장 중요합니다. 신청자가 농협 조합원인지 확인합니다.

### GUI로 따라하기

**1단계: 새 쿼리로 조합원정보 로드**
```
다시 "데이터" → "데이터 가져오기" → "파일에서" → "Excel"
  → "조합원정보_2024.xlsx" 선택
  → "로드" 버튼 클릭
```

✅ **결과**: 새로운 시트 "조합원정보_2024" 가 생성됩니다

### 이제 두 데이터를 연결합니다

**2단계: 쿼리 편집 (매칭 규칙 설정)**
```
"2024_신청자명단" 시트 → 우클릭
  → "쿼리 편집" 클릭
  → Power Query 편집 창이 열림
```

**3단계: 병합(Merge) 버튼 찾기**
```
Power Query 상단 메뉴
  → "홈" 탭 (또는 "변환" 탭)
  → "테이블 병합" 또는 "병합" 버튼 클릭
```

**4단계: 매칭 조건 3가지 설정**
```
왼쪽 테이블: 2024_신청자명단
오른쪽 테이블: 조합원정보_2024

매칭 조건:
  1) "이름" = "이름"
  2) "생년월일" = "생년월일"  
  3) "핸드폰" = "핸드폰"

(3가지 모두 일치해야만 조합원으로 인정)
```

✅ **결과**: 신청자 옆에 조합원 정보 컬럼이 추가됩니다

---

## 🎯 Step 3: 농협 양식으로 최종 정리하기

### 필요한 컬럼만 선택하기

**1단계: 필요 없는 컬럼 제거**
```
Power Query 편집 창에서
  → 확인하려는 컬럼들 마우스 오른쪽 클릭
  → "제거" 선택
  
남길 컬럼: 이름, 생년월일, 핸드폰, 주소, 신청항목, 조합원여부
```

**2단계: 컬럼 순서 정리**
```
각 컬럼 헤더를 드래그해서 순서 변경
(농협 양식 순서대로 정렬)
```

**3단계: 텍스트 정리 (선택사항)**
```
Power Query → "홈" → "열 변환" → "텍스트" → "소문자/대문자"
(필요한 컬럼만 선택)
```

**4단계: 중복 제거**
```
"홈" → "중복 제거" 버튼
  → 이름+생년월일+핸드폰 체크
  → "확인" 클릭
```

---

## 💻 M 코드로 자동화하기 (선택사항)

### 기본 병합 쿼리 M 코드

```m
let
    원본데이터 = Excel.Workbook(File.Contents("C:\\Users\\Username\\2024_신청자명단.xlsx"))[Data]{0}[Value],
    조합원정보 = Excel.Workbook(File.Contents("C:\\Users\\Username\\조합원정보_2024.xlsx"))[Data]{0}[Value],
    병합결과 = Table.NestedJoin(
        원본데이터,
        {"이름", "생년월일", "핸드폰"},
        조합원정보,
        {"이름", "생년월일", "핸드폰"},
        "조합원",
        JoinKind.LeftOuter
    ),
    선택컬럼 = Table.SelectColumns(병합결과, {"이름", "생년월일", "핸드폰", "주소", "신청항목", "조합원"}),
    중복제거 = Table.Distinct(선택컬럼, {"이름", "생년월일", "핸드폰"})
in
    중복제거
```

**M 코드 사용법:**
```
1. 쿼리 편집 → 오른쪽 하단 "고급 편집기" 클릭
2. 위의 코드를 복사해 붙여넣기
3. 파일 경로(C:\\Users\\...) 자신의 경로로 수정
4. "완료" 버튼 클릭
```

---

## 🎁 최종 결과 저장하기

### GUI에서 최종 데이터 로드

**1단계: 완료 후 로드**
```
모든 변환 완료 후
  → Power Query 편집 창 우상단 "닫기 및 로드" 클릭
  → "새 시트로 로드" 선택
```

**2단계: 결과 확인**
```
새 시트 "쿼리결과" 또는 "신청자_정리" 가 생성됨
조합원정보가 정확히 매칭되었는지 확인
```

**3단계: 필요한 형식으로 변환**
```
결과 데이터 → 전체 선택 (Ctrl+A)
  → "데이터" → "테이블로 변환" (또는 이미 테이블)
  → 농협 담당자 양식에 복사-붙여넣기
```

---

## ⚙️ 자주하는 실수 & 해결법

### ❌ "조합원정보가 매칭되지 않았어요"
**원인**: 이름/생년월일/핸드폰 중 하나가 다름

**해결법**:
1. 두 파일의 데이터 형식 확인 (공백, 대소문자, 하이픈 등)
2. 생년월일이 "1990-01-15" vs "19900115" 형식 다를 수 있음
3. 핸드폰이 "010-1234-5678" vs "01012345678" 형식 다를 수 있음

→ Power Query에서 "텍스트 정리" 기능으로 형식 통일

### ❌ "파일을 찾을 수 없다고 에러가 나요"
**원인**: 파일 경로가 잘못됨

**해결법**:
1. M 코드에서 파일 경로 다시 확인
2. 파일을 항상 같은 폴더에 저장 (예: "문서" 폴더)
3. Power Query "데이터 소스 설정" → "경로 변경"으로 쉽게 수정 가능

### ❌ "결과가 너무 많거나 적어요"
**원인**: 조합원/비조합원 필터링 실수

**해결법**:
```
Power Query 편집 → "조합원" 컬럼의 필터 아이콘 클릭
  → "조합원" 체크, "null" (비조합원) 체크
  → 필요한 것만 선택 후 "확인"
```

---

## 📞 버전 정보

- **v3.0**: GUI + M 코드 (2024년 1월)
- **대상**: 초급자 (Power Query 미경험자)
- **특징**: 따라만 하면 결과물이 나옴
- **담당**: 원주농협 IT지원팀

---

## 🔗 다음 단계

1. **이 가이드로 첫 실행** → 조합원 매칭 데이터 생성
2. **매월 반복** → 같은 쿼리 재사용 (파일만 바꾸면 됨)
3. **자동화** → M 코드로 버튼 1번으로 완료
4. **VBA 연동** (고급) → 매월 자동 실행 가능

---

**"Power Query는 어렵지 않습니다. 단 3가지 버튼만 이해하면 충분합니다.**
**1) 로드 (파일 연결)**  
**2) 병합 (조합원 확인)**  
**3) 로드 (결과 저장)"**
