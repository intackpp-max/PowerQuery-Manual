# Power Query 실무 매뉴얼 v2.0

농협 데이터 정제 및 변환을 위한 실무 가이드

---

## 📋 목차
1. Power Query란?
2. 데이터 로드 및 정제
3. 언어 분리 (Split Column)
4. 행-열 변환 (Unpivot)
5. 데이터 병합 (Append)
6. 실무 예제

---

## 1. Power Query란?

**정의**: Excel에 내장된 데이터 정제 및 변환 도구

**핵심 역할**:
- 외부 데이터 자동 로드
- 복잡한 데이터 정제 자동화
- 반복되는 작업 제거

### 시작 방법
Excel > 데이터 탭 > 데이터 가져오기 > CSV 또는 다른 원본

---

## 2. 데이터 로드 및 정제

### Step 1: 데이터 원본 선택
```
Excel > 데이터 > 데이터 가져오기 > CSV에서
```

### Step 2: 인코딩 확인
- UTF-8 또는 EUC-KR 선택
- 한글 깨짐 방지

### Step 3: 기본 정제
- 불필요한 열 제거: 열 우클릭 > 제거
- 데이터 타입 변경: 열 선택 > 데이터 타입 지정
- 빈 행 제거: 홈 > 행 제거 > 빈 행 제거

**예시**:
| 입력 | 정제 후 |
|-----|--------|
| 2024-01-15 | 2024-01-15 (날짜) |
| 50000 | 50000 (숫자) |
| 품목명 | 품목명 (텍스트) |

---

## 3. 언어 분리 (Split Column)

### 용도
"김철수 농사"를 "김철수"와 "농사"로 분리, 또는 "사과-5kg"를 분리

### 단계별 방법

1. **분리할 열 선택**
   - 열 우클릭 > 열 분리 > 구분 기호 기준

2. **구분 기호 선택**
   - 공백, 세미콜론, 하이픈, 커스텀 문자 등

3. **분리 옵션**
   - 왼쪽 기준: 첫 번째만 분리
   - 오른쪽 기준: 마지막만 분리
   - 모두: 모든 구분점에서 분리

### 실무 예제

**입력 데이터**:
```
김철수 | 농사
이영희 | 축산
박민준 | 임업
```

**처리 단계**:
1. "담당자" 열 선택 > 열 분리
2. 구분 기호 "공백" 선택
3. 결과 적용

**출력**:
```
이름 | 업종
김철수 | 농사
이영희 | 축산
박민준 | 임업
```

---

## 4. 행-열 변환 (Unpivot)

### 용도
월별 판매액이 열로 분산된 데이터를 행으로 정규화

### Before (원본)
```
제품 | 1월 | 2월 | 3월
쌀 | 1000 | 1200 | 1100
보리 | 800 | 900 | 850
옥수수 | 600 | 700 | 750
```

### After (Unpivot)
```
제품 | 월 | 판매액
쌀 | 1월 | 1000
쌀 | 2월 | 1200
쌀 | 3월 | 1100
보리 | 1월 | 800
...
```

### 단계별 방법

1. **정규화할 열 선택** (제품 열 제외)
   - Ctrl + 클릭으로 여러 열 선택

2. **변환 > Unpivot 열 클릭**

3. **옵션**:
   - Unpivot 열: 선택된 모든 열
   - 특정 열만: 각 열을 우클릭 > Unpivot 열

4. **결과 확인**
   - 새로운 "특성" 열 = 원래 열 이름 (1월, 2월...)
   - 새로운 "값" 열 = 원래 데이터 (1000, 1200...)

### 열 이름 변경
열 헤더 더블클릭:
- "특성" → "월"
- "값" → "판매액"

---

## 5. 데이터 병합 (Append)

### 용도
여러 개의 유사한 테이블을 하나로 결합

### Before
**2024년 Q1**:
```
지점 | 판매액 | 날짜
서울 | 5000 | 2024-01
부산 | 3000 | 2024-01
```

**2024년 Q2**:
```
지점 | 판매액 | 날짜
서울 | 5500 | 2024-04
부산 | 3200 | 2024-04
```

### After (Append)
```
지점 | 판매액 | 날짜
서울 | 5000 | 2024-01
부산 | 3000 | 2024-01
서울 | 5500 | 2024-04
부산 | 3200 | 2024-04
```

### 단계별 방법

1. **첫째 쿼리 생성** (Q1 데이터)

2. **새로 추가** > 다른 쿼리를 현재에 추가
   - Append 선택 (Two tables)

3. **Primary table**: 첫째 쿼리
   **Table to append**: Q2 쿼리

4. **열 자동 매핑** 확인
   - 지점 ↔ 지점
   - 판매액 ↔ 판매액
   - 날짜 ↔ 날짜

### 주의사항
- 열 이름이 정확히 일치해야 함
- 다른 이름일 경우 수동으로 매핑
- 열 순서는 무관

---

## 6. 실무 통합 예제

### 시나리오
농협 지점별 월간 판매 데이터를 정제하여 분석 보고서 작성

### 원본 데이터 (CSV)
```
지점명,담당자명,1월,2월,3월,상품명-수량
서울,김철수,500000,520000,550000,쌀-100kg
부산,이영희,300000,320000,340000,보리-80kg
대구,박민준,200000,220000,240000,옥수수-60kg
```

### 처리 순서

#### Step 1: 데이터 로드
```
데이터 > 데이터 가져오기 > CSV에서
인코딩: UTF-8
```

#### Step 2: 담당자명 분리
- "담당자명" 열 선택
- 열 분리 > 구분 기호 선택 (없음 - 그대로 유지)

#### Step 3: 상품명-수량 분리
- "상품명-수량" 선택
- 열 분리 > 하이픈 구분
- 결과: "상품명", "수량" 열 생성

#### Step 4: 월별 정규화 (Unpivot)
- 1월, 2월, 3월 열 선택
- 변환 > Unpivot 열
- "특성" → "월"
- "값" → "판매액"

#### Step 5: 데이터 확인
```
지점명 | 담당자명 | 상품명 | 수량 | 월 | 판매액
서울 | 김철수 | 쌀 | 100 | 1월 | 500000
서울 | 김철수 | 쌀 | 100 | 2월 | 520000
서울 | 김철수 | 쌀 | 100 | 3월 | 550000
...
```

#### Step 6: 로드
- 홈 > 닫기 및 로드
- Excel 테이블로 로드

### 결과 활용
- 피벗 테이블: 지점별, 월별 판매 분석
- 차트: 추세 시각화
- 보고서: 자동 갱신 가능

---

## 💡 Power Query 팁

### 성능 최적화
- 로드 후 불필요한 열 제거 (메모리 절약)
- 복잡한 정제는 Power Query에서 (Excel 함수 최소화)
- 원본 데이터 별도 보관 (실수 방지)

### 자동 갱신 설정
```
Excel > 데이터 > 모든 새로고침
또는 특정 쿼리 우클릭 > 새로고침
```

### 오류 처리
- 빨간색 오류: 열 이름 불일치 확인
- 데이터 타입 오류: 변환 단계에서 확인
- 인코딩 오류: 원본 파일 인코딩 확인

---

## 🎯 자주 묻는 질문

**Q: Power Query를 사용해야 하는 이유?**
A: VBA 대비 유지보수 쉬움, GUI 기반 직관적, 성능 우수

**Q: 대용량 데이터도 처리 가능?**
A: 100만 행 이상도 처리 가능 (메모리 충분할 경우)

**Q: Power Query 작업은 저장되나?**
A: 쿼리와 변환 단계가 Excel에 저장되어 자동 갱신 가능

---

**최종 업데이트**: 2024년 1월
**버전**: v2.0
**용도**: 농협 실무자용 기초 가이드
